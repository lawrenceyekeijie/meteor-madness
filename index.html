<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Asteroid Impact Simulator</title>

  <!-- Roboto font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

  <style>
    /* 你原来的 CSS 都保留 */
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#7c3aed; --muted:#94a3b8; --glass:rgba(255,255,255,0.03);
      font-family: 'Roboto', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body,#map{height:100%;}
    body{margin:0;height:100vh;display:flex;background:linear-gradient(180deg,#071026 0%, #081426 60%);
      color:#e6eef8;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;overflow:hidden;}
    header {background:#111; color:#fff; padding:10px 20px; display:flex; justify-content:space-between; align-items:center;}
    header nav a {color:#fff; margin-left:15px; text-decoration:none; font-weight:500;}
    header nav a:hover { text-decoration:underline; }
    .app{display:flex; gap:18px; width:100%; padding:18px; box-sizing:border-box;}
    .left{flex:1; min-width:320px; max-width:860px; height:calc(100vh - 36px); border-radius:14px; overflow:hidden; box-shadow:0 8px 30px rgba(2,6,23,0.6); position:relative;}
    #map{width:100%; height:100%;}
    .right{width:420px; max-width:40%; min-width:280px; display:flex; flex-direction:column; gap:14px;}
    .card{background:var(--card); border-radius:12px; padding:12px; box-shadow:0 6px 20px rgba(2,6,23,0.6);}    
    .controls{display:flex;flex-direction:column;gap:10px;}
    .row{display:flex;gap:10px;align-items:center;}
    .label{min-width:88px;font-size:13px;color:var(--muted);}    
    .value{font-weight:600;min-width:90px;text-align:right}
    input[type=range]{width:100%;}
    .outputs{display:flex;flex-direction:column;gap:8px}
    .output{background:var(--glass); padding:10px;border-radius:10px; font-size:13px;}
    .buttons{display:flex;gap:8px;flex-wrap:wrap}
    button{background:linear-gradient(180deg,var(--accent),#5b21b6);border:none;color:white;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(92,33,182,0.18)}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);box-shadow:none;color:var(--muted)}
    .legend{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .legend .sw{width:18px;height:10px;border-radius:4px}
    .sw.red{background:linear-gradient(90deg, rgba(255,69,58,0.95), rgba(255,86,86,0.6))}
    .sw.orange{background:linear-gradient(90deg,#ff8a00,#ffb86b)}
    .sw.yellow{background:linear-gradient(90deg,#ffd54a,#fff59d)}
    .sw.mild{background:linear-gradient(90deg,#c8f7a6,#e6ffcf)}
    @media (max-width:920px){.app{flex-direction:column;padding:10px} .left{max-width:none;height:60vh} .right{width:100%;max-width:none;}}
  </style>
</head>
<body>
  <!-- 顶部导航 -->
  <header>
    <h2>☄️ Asteroid Impact Simulator</h2>
    <nav>
      <a href="index.html">Home</a>
      <a href="resources.html">Resources</a>
      <a href="about.html">About</a>
    </nav>
  </header>

  <div class="app">
    <div class="left card">
      <div id="map"></div>
      <div class="fall-wrap" id="fallWrap" aria-hidden="true"></div>
    </div>

    <div class="right">
      <div class="card">
        <h3 style="margin:6px 0 10px 0">Asteroid Impact Simulator</h3>
        <div class="controls" id="controls">

          <!-- 原有滑块保留 -->

          <div class="row">
            <div class="label">Mass (kg)</div>
            <div style="flex:1">
              <input id="massRange" type="range" min="1e6" max="1e13" step="1" value="1e9">
            </div>
            <div class="value" id="massVal">1,000,000,000</div>
          </div>

          <div class="row">
            <div class="label">Speed (m/s)</div>
            <div style="flex:1"><input id="speedRange" type="range" min="5000" max="50000" step="100" value="20000"></div>
            <div class="value" id="speedVal">20,000</div>
          </div>

          <div class="row">
            <div class="label">Latitude</div>
            <div style="flex:1"><input id="latRange" type="range" min="-90" max="90" step="0.0001" value="0"></div>
            <div class="value" id="latVal">0.0000°</div>
          </div>

          <div class="row">
            <div class="label">Longitude</div>
            <div style="flex:1"><input id="lngRange" type="range" min="-180" max="180" step="0.0001" value="0"></div>
            <div class="value" id="lngVal">0.0000°</div>
          </div>

          <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:6px 0">
          <div class="row">
            <div class="label">Deflect (%)</div>
            <div style="flex:1"><input id="deflectRange" type="range" min="0" max="90" step="1" value="0"></div>
            <div class="value" id="deflectVal">0%</div>
          </div>

          <div class="row">
            <div class="label">Fragment (%)</div>
            <div style="flex:1"><input id="fragRange" type="range" min="0" max="90" step="1" value="0"></div>
            <div class="value" id="fragVal">0%</div>
          </div>

          <div class="buttons" style="margin-top:6px">
            <button id="simulateBtn">Simulate Impact</button>
            <button id="resetBtn" class="secondary">Reset</button>
            <button id="animateBtn" class="secondary">Animate Fall</button>
            <button id="loadNEOBtn" class="secondary">Load NEO</button>
          </div>
        </div>
      </div>

      <div class="card outputs">
        <div class="output"><strong>Asteroid diameter:</strong> <span id="astDia">—</span> m</div>
        <div class="output"><strong>Kinetic energy (J):</strong> <span id="keVal">—</span> (<span id="keSci">—</span>)</div>
        <div class="output"><strong>Estimated crater diameter:</strong> <span id="craterVal">—</span> km</div>
        <div class="output"><strong>Blast radii (km):</strong> <span id="radiiVal">—</span></div>
        <div class="output"><strong>Estimated affected population:</strong> <span id="popAffected">—</span></div>
        <div class="output"><strong>Estimated fatalities:</strong> <span id="fatalitiesVal">—</span></div>
        <div class="output"><strong>NASA NEO:</strong> <span id="neoInfo">Click "Load NEO"…</span></div>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <script>
    /* 这里粘贴你原本的 JS 逻辑（computeImpact, simulate 等等，全保留） */

    // === NASA NEO API Integration ===
    async function loadNEOData() {
      try {
        const today = new Date().toISOString().split("T")[0];
        const url = `https://api.nasa.gov/neo/rest/v1/feed?start_date=${today}&end_date=${today}&api_key=DEMO_KEY`;
        const res = await fetch(url);
        const data = await res.json();

        const neos = data.near_earth_objects[today];
        if (!neos || neos.length === 0) {
          document.getElementById('neoInfo').textContent = "No NEOs found for today.";
          return;
        }

        const first = neos[0];
        const name = first.name;
        const diameter = first.estimated_diameter.meters.estimated_diameter_max.toFixed(0);
        const speed = parseFloat(first.close_approach_data[0].relative_velocity.kilometers_per_second) * 1000;
        const missDistance = parseFloat(first.close_approach_data[0].miss_distance.kilometers).toFixed(0);

        document.getElementById('neoInfo').textContent =
          `${name} — ~${diameter} m, ${Math.round(speed).toLocaleString()} m/s, miss ${missDistance} km`;

        // 转换直径 → 质量 (体积*密度)
        const radius = diameter / 2;
        const volume = (4/3) * Math.PI * Math.pow(radius, 3);
        const mass = volume * 3000; // 假设密度 3000 kg/m³

        massRange.value = mass;
        speedRange.value = speed;
        updateDisplays();
        simulate(true);

      } catch (e) {
        console.error("NEO fetch failed", e);
        document.getElementById('neoInfo').textContent = "Failed to load NEO data.";
      }
    }

    document.getElementById('loadNEOBtn').addEventListener('click', loadNEOData);
  </script>
</body>
</html>

